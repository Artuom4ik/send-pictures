# Микросервис для скачивания файлов

Микросервис помогает работе основного сайта, сделанного на CMS и обслуживает
запросы на скачивание архивов с файлами. Микросервис не умеет ничего, кроме упаковки файлов
в архив. Закачиваются файлы на сервер через FTP или админку CMS.

Создание архива происходит на лету по запросу от пользователя. Архив не сохраняется на диске, вместо этого по мере упаковки он сразу отправляется пользователю на скачивание.


___
>### Системные требования
- `Python` 3.10.12(или выше)
- `Windows` 10, 11 или `Linux`(Ubuntu 22.*)
___
>### Установка

- Скачайте код командой

```bash
git clone https://github.com/Artuom4ik/send-pictures.git
```
- Перейте в рабочую директорию

```bash
cd send-pictures
```

- Создайте виртуальное окружение командой

```bash
python3 -m venv myvenv
```

- Активируйте виртуальное окружение командой

`Linux`

```bash
source myvenv/bin/activate
```

`Windows`

```bash
.\myvenv\Scripts\activate
```

- Установите зависимости командой 

```bash
pip install -r requirements.txt
```
___
>### Как запустить

`Windows`

```bash
python server.py
```

`Linux`

```bash
python3 server.py
```

Сервер запустится на порту 8080, чтобы проверить его работу перейдите в браузере на страницу [http://127.0.0.1:8080/](http://127.0.0.1:8080/).

___
>### Допольнительные параметры запуска сервера

- При запуске сервера можно указать 3 параметра

`Linux`

```bash
python3 server.py -f test_photos -d True -l True
```

```bash
python3 server.py --folder test_photos --delay True --log True
```
___

`Windows`

```bash
python server.py -f test_photos -d True -l True
```

```bash
python server.py --folder test_photos --delay True --log True
```
___

- `-f`, `--folder` - параметры для указания пути к каталогам с фотографиями. По умолчанию стоит `test_photos`.

- `-d`, `--delay` - параметры для включения задержки, если `--delay True` или `-d True`, то будет включена задержка при отправке архива. По умолчанию стоит `False`.

- `-l`, `--log` - параметры для включения логов, если `--log True` или `-l True`, то логирование будет включено и в консоли будет отображаться информация по отправке определенного количества байтов от сервера пользователю. По умолчанию стоит `False`.

- Параметры можно передавать по отдельности.

___
>### Как проверить работу сервера

- У сервера есть 2 эндпоинта. 

`/` - для отображения главной страницы, в которой отображается доступные архивы для скачивания.

`/archive/{archive_hash}/` - для скачивания определенного архива. `archive_hash` - xеш определенного архива. Задается названием каталога с файлами, выглядит структура каталога так:

```
- photos
    - 3bea29ccabbbf64bdebcc055319c5745
      - 1.jpg
      - 2.jpg
      - 3.jpg
    - af1ad8c76fda2e48ea9aed2937e972ea
      - 1.jpg
      - 2.jpg
```

- Пример ссылок для скачивания архива:

```
http://127.0.0.1:8080/archive/3bea29ccabbbf64bdebcc055319c5745/
```

```
http://127.0.0.1:8080/archive/af1ad8c76fda2e48ea9aed2937e972ea/
```

___
>### Цели проекта

Код написан в учебных целях — это урок в курсе по Python и веб-разработке на сайте [Devman](https://dvmn.org).